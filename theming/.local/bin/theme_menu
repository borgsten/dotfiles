#!/usr/bin/env bash

THEMES_DIR="${HOME}/.config/theming/themes"
CURRENT_THEME_DIR="${HOME}/.config/theming/current"
CURRENT_THEME_NAME=$(basename "$(realpath "${CURRENT_THEME_DIR}")")

themes=()
current_index=0
for theme in "${THEMES_DIR}"/*; do
    theme=$(basename "${theme}")
    if [[ -f "${THEMES_DIR}/${theme}/light.mode" ]]; then
        theme+="(light mode)"
    fi

    if [[ "${theme}" == "${CURRENT_THEME_NAME}" ]]; then
        current_index=$((${#themes[@]} + 1))
    fi

    themes+=("${theme}")
done

new_theme=$(printf '%s\n' "${themes[@]}" | walker --dmenu --current "${current_index}")
new_theme=$(echo "${new_theme}" | sed -E "s/\(.*\)//")

if [[ -z "${new_theme}" ]]; then
    exit 0
fi

if [[ "${new_theme}" == "${CURRENT_THEME_NAME}" ]]; then
    exit 0
fi

change_theme "${new_theme}"
